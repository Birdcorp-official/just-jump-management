<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Just Jump - Planning</title>

<style>
body {
  font-family: Arial, sans-serif;
  margin: 0;
  background: #0f0f0f;
  color: white;
}

header {
  background: #111;
  padding: 15px;
  text-align: center;
  border-bottom: 3px solid #00c853;
}

.container { padding: 20px; }

.counter {
  background: #00c853;
  color: black;
  padding: 10px;
  border-radius: 8px;
  margin-bottom: 20px;
  font-weight: bold;
  text-align: center;
}

.slot {
  background: #1c1c1c;
  border-left: 5px solid #00c853;
  border-radius: 8px;
  padding: 12px;
  margin-bottom: 12px;
}

.session {
  background: #00c853;
  color: black;
  padding: 6px;
  margin: 5px 0;
  border-radius: 5px;
  font-weight: bold;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.session-info { flex: 1; }

.session-actions button {
  margin-left: 5px;
  padding: 4px 8px;
  font-size: 12px;
}

button {
  background: #00c853;
  border: none;
  padding: 8px 14px;
  color: black;
  border-radius: 5px;
  cursor: pointer;
  font-weight: bold;
}

button:hover {
  background: #ff1744;
  color: white;
}

input, select {
  padding: 6px;
  margin: 5px 0;
  border-radius: 5px;
  border: none;
}

.hidden { display: none; }

.admin-panel {
  background: #1c1c1c;
  padding: 15px;
  border-radius: 8px;
  margin-bottom: 20px;
  border: 1px solid #00c853;
}
</style>
</head>

<body>

<header>
  <h2>JUST JUMP ‚Äî Planning Sessions</h2>
</header>

<div class="container">

  <div class="counter" id="totalCounter">
    üë• Visiteurs pr√©sents : 0
  </div>

  <!-- Connexion admin -->
  <div id="login">
    <h3>Connexion Admin</h3>
    <input type="password" id="password" placeholder="Mot de passe">
    <button onclick="login()">Connexion</button>
  </div>

  <!-- Panel admin -->
  <div id="adminPanel" class="admin-panel hidden">
    <h3>Ajouter une session</h3>
    <input type="text" id="sessionName" placeholder="Nom">
    <input type="number" id="peopleCount" placeholder="Nb personnes" min="1" value="1">
    <select id="sessionTime"></select>
    <button onclick="addSession()">Ajouter</button>
  </div>

  <h3>Planning</h3>
  <div id="slots"></div>

</div>

<script>
const ADMIN_PASSWORD = "admin123";
const STORAGE_KEY = "justjump_sessions";

// Horaires fixes
const slots = [];
for (let h = 9; h <= 20; h++) {
  slots.push(`${h.toString().padStart(2,'0')}:00`);
  if (h !== 20) slots.push(`${h.toString().padStart(2,'0')}:30`);
}

let sessions = {};
let totalVisitors = 0;

slots.forEach(t => sessions[t] = []);

function saveData() {
  localStorage.setItem(STORAGE_KEY, JSON.stringify({ sessions, totalVisitors }));
}

function loadData() {
  const data = localStorage.getItem(STORAGE_KEY);
  if (!data) return;

  const parsed = JSON.parse(data);
  sessions = parsed.sessions || sessions;
  totalVisitors = parsed.totalVisitors || 0;
}

function updateCounter() {
  document.getElementById("totalCounter").textContent =
    "üë• Visiteurs pr√©sents : " + totalVisitors;
}

function login() {
  const pwd = document.getElementById("password").value;
  if (pwd === ADMIN_PASSWORD) {
    document.getElementById("login").classList.add("hidden");
    document.getElementById("adminPanel").classList.remove("hidden");
  } else {
    alert("Mot de passe incorrect");
  }
}

function addSession() {
  const name = document.getElementById("sessionName").value.trim();
  const time = document.getElementById("sessionTime").value;
  const people = parseInt(document.getElementById("peopleCount").value) || 1;

  if (!name) return alert("Nom requis");

  sessions[time].push({
    id: Date.now(),
    name,
    people,
    created: Date.now(),
    duration: 3600000
  });

  totalVisitors += people;
  updateCounter();
  saveData();

  document.getElementById("sessionName").value = "";
  document.getElementById("peopleCount").value = 1;
  render();
}

function deleteSession(time, id) {
  const session = sessions[time].find(s => s.id === id);
  if (!session) return;

  totalVisitors -= session.people;
  sessions[time] = sessions[time].filter(s => s.id !== id);
  updateCounter();
  saveData();
  render();
}

function changeTime(time, id) {
  const minutes = prompt("Nouveau temps restant (minutes) :");
  if (!minutes) return;

  const session = sessions[time].find(s => s.id === id);
  session.duration = parseInt(minutes) * 60000;
  session.created = Date.now();
  saveData();
  render();
}

function render() {
  const container = document.getElementById("slots");
  container.innerHTML = "";

  slots.forEach(time => {
    let newList = [];

    sessions[time].forEach(s => {
      const expired = Date.now() - s.created >= s.duration;
      if (expired) {
        totalVisitors -= s.people;
      } else {
        newList.push(s);
      }
    });

    sessions[time] = newList;
    if (sessions[time].length === 0) return;

    const slotDiv = document.createElement("div");
    slotDiv.className = "slot";

    const title = document.createElement("h4");
    title.textContent = time;
    slotDiv.appendChild(title);

    sessions[time].forEach(s => {
      const remaining = Math.max(0, s.duration - (Date.now() - s.created));
      const minutes = Math.floor(remaining / 60000);
      const seconds = Math.floor((remaining % 60000) / 1000);

      const div = document.createElement("div");
      div.className = "session";

      const info = document.createElement("div");
      info.className = "session-info";
      info.textContent = `${s.name} (${s.people} pers) ‚Äî ${minutes}m ${seconds}s`;

      const actions = document.createElement("div");
      actions.className = "session-actions";

      actions.innerHTML = `
        <button onclick="changeTime('${time}', ${s.id})">‚è±Ô∏è</button>
        <button onclick="deleteSession('${time}', ${s.id})">üóëÔ∏è</button>
      `;

      div.appendChild(info);
      div.appendChild(actions);
      slotDiv.appendChild(div);
    });

    container.appendChild(slotDiv);
  });

  updateCounter();
  saveData();
}

// remplir le select
function init() {
  const select = document.getElementById("sessionTime");
  slots.forEach(t => {
    const option = document.createElement("option");
    option.value = t;
    option.textContent = t;
    select.appendChild(option);
  });

  loadData();
  render();
}

setInterval(render, 1000);
init();
</script>

</body>
</html>